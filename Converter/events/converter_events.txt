# -*- ck2.events -*-

namespace = hip_converter

# startup event
character_event = {
	id = hip_converter.0

	is_triggered_only = yes
	hide_window = yes

	religion = hip_religion

	trigger = {
		has_landed_title = e_hip
	}

	immediate = {
		narrative_event = { id = hip_converter.1 }
	}
}

# Welcome narrative event.
narrative_event = {
	id    = hip_converter.1
	desc  = hip_converter.1.desc
	title = hip_converter.1.title

	picture = GFX_evt_rider_adventure
	border  = GFX_event_narrative_frame_diplomacy

	is_triggered_only = yes
	major = yes
	
	major_trigger = { ai = no }

	# Prepare for conversion
	option = {
		name = hip_converter.1.opt.a
		e_hip = { owner = { character_event = { id = hip_converter.2 } } }
	}

	# Do nothing
	option = {
		name = hip_converter.1.opt.b
	}
}

# Prepare for conversion: reset title names so as many tags convert as
# possible, and change French HRE into German HRE so there is an HRE in EU4.
character_event = {
	id = hip_converter.2
	
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		# attempt to reset title names
		# touching culture causes reloading localization
		culture = THIS
		any_playable_ruler = { culture = THIS }
		# resetting dynamic nomad titles replaces localization names
		# with dynastic names, so skip those
		any_landed_title = {
			limit = {
				has_holder = yes
				is_nomadic = no
			}
			set_name = ""
		}
		# convert French HRE to German HRE
		character_event = { id = hip_converter.2 }
	}
}

# Convert French HRE to German HRE
character_event = {
	id = hip_converter.3
	
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		e_hre_french = { has_holder = yes }
		e_hre = { has_holder = no }
	}
	
	immediate = {
		e_hre_french = { owner = { save_event_target_as = frenchie } } # event targets are just more clear
		e_hre = {            
			# in case the title isn't titular somehow, take care of that
			any_direct_de_jure_vassal_title = {
				de_jure_liege = e_null
			}
			# create regular HRE for the frenchie
			grant_title = event_target:frenchie
		}
		# transfer de jure vassals under "real" HRE
		e_hre_french = {
			any_direct_de_jure_vassal_title = {
				de_jure_liege = e_hre
			}
		}
		# force e_hre to become primary title of owner
		e_hre = { make_primary_title = yes }
		# why is this comment even here?
		e_hre_french = {        
			destroy_landed_title = THIS
		}
	}
}
